<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fi"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>MainGUI.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;Ohjelmistotuotantoprojekti1&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">gui</a> &gt; <span class="el_source">MainGUI.java</span></div><h1>MainGUI.java</h1><pre class="source lang-java linenums">package gui;

import java.net.URL;
import java.util.List;
import java.util.ResourceBundle;
import javafx.beans.binding.Bindings;
import javafx.beans.binding.BooleanBinding;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.ListCell;
import javafx.scene.control.TabPane;
import javafx.scene.layout.*;
import javafx.util.converter.DoubleStringConverter;
import model.Diagnose;
import model.Drug;
import model.Employee;
import model.Message;
import model.Patient;
import model.Prescription;
import model.User;
import model.User_IF;


/**
 * FXML Controller class
 *
 * @author joosiika
 */
<span class="nc" id="L34">public class MainGUI implements Initializable, MainGUI_IF {</span>
    
    @FXML
    private AnchorPane root;
    @FXML
    private TabPane tabPane;
    private SideBarGUI_IF sideBar;
    private LoginGUI_IF login;
    private PrescriptionFormGUI_IF prescriptionForm;
    private UserFormGUI_IF userForm;
    private MessageFormGUI_IF messageForm;
    private SideBarListView_IF&lt;Patient&gt; patientListView;
    private SideBarListView_IF&lt;Drug&gt; drugListView;
    private SideBarListView_IF&lt;Prescription&gt; prescriptionListView;
    private ListTabGUI_IF&lt;String&gt; prescriptionTab;
    private ListTabGUI_IF&lt;String&gt; drugTab;
    private ListTabGUI_IF&lt;String&gt; messageTab;
    private ListTabGUI_IF&lt;Prescription&gt; patientPrescriptionTab;
    private ListTabGUI_IF&lt;String&gt; diagnoseTab;
    private ListTabGUI_IF&lt;Diagnose&gt; patientDiagnoseTab;
    private SideBarListView_IF&lt;Message&gt; receivedMessageListView;
    private SideBarListView_IF&lt;Message&gt; sentMessageListView;    
    private SideBarListView_IF&lt;User_IF&gt; userListView;
    private SideBarListView_IF&lt;Employee&gt; employeeListView;
    private SideBarListView_IF&lt;String&gt; databaseListView;
    
    private Controller_IF controller;
    
    private AppStatus status;
    
    private DoubleStringConverter dsc;    
    
    //Load login-component on initalization
    @Override
    public void initialize(URL url, ResourceBundle rb) {
<span class="nc" id="L69">        this.controller = new Controller(this);</span>
<span class="nc" id="L70">        this.dsc = new DoubleStringConverter();</span>
<span class="nc" id="L71">        setLogin();</span>
<span class="nc" id="L72">        setStatus(AppStatus.IDLE);</span>
<span class="nc" id="L73">    }</span>
    
    public AppStatus getStatus() {
<span class="nc" id="L76">        return status;</span>
    }

    public void setStatus(AppStatus status) {
<span class="nc" id="L80">        this.status = status;</span>
<span class="nc" id="L81">    }</span>
    
    //Creates a new instance of the LoginGUI and passes itself as a parameter
    //Adds the LoginGUI as a child-component to the MainGUI's anchor pane
    @Override
    public void setLogin() {
<span class="nc" id="L87">        this.login = new LoginGUI();</span>
<span class="nc" id="L88">        this.login.getButton().setOnAction(e -&gt; {</span>
<span class="nc" id="L89">            this.controller.login(this.login.getUsername(), this.login.getPassword());</span>
<span class="nc" id="L90">        });</span>
<span class="nc" id="L91">        this.root.getChildren().add((LoginGUI)this.login);</span>
<span class="nc" id="L92">    }</span>
    
    //Set login failed message
    @Override
    public void setLoginFailed() {
<span class="nc" id="L97">        this.login.addMessage(&quot;Kirjautuminen epäonnistui. Väärä käyttäjätunnus tai salasana!&quot;);</span>
<span class="nc" id="L98">    }</span>
    
    //Set access denied message
    @Override
    public void setAccessDenied() {
<span class="nc" id="L103">        this.root.getChildren().clear();</span>
<span class="nc" id="L104">        this.root.getChildren().add(new Label(&quot;Tunnuksesi on lukittu. Ota yhteys ylläpitäjään.&quot;));</span>
<span class="nc" id="L105">    }</span>
    
    //Removes the login component and loads the side bar component
    //Component type is defined by user's priviledges
    //1 - load nurses sidebar components
    //2 - load doctors sidebar components
    //3 - load administrators sidebar components
    //0 - should print out &quot;access revoked&quot; and instructions to contact the administrator
    @Override
    public void setSideBar() {
<span class="nc" id="L115">        this.root.getChildren().remove((LoginGUI) this.login);</span>
<span class="nc" id="L116">        this.sideBar = new SideBarGUI(this);</span>
<span class="nc" id="L117">        this.sideBar.getMessageButton().setOnMousePressed(m -&gt;{</span>
<span class="nc" id="L118">            this.controller.createNewMessage();</span>
<span class="nc" id="L119">        });</span>
<span class="nc" id="L120">        this.sideBar.getSearchField().setOnKeyReleased(e -&gt; {</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if(this.patientListView != null){</span>
<span class="nc" id="L122">            this.patientListView.filter(this.sideBar.getSearchField().getText());</span>
        }
<span class="nc bnc" id="L124" title="All 2 branches missed.">        if(this.drugListView != null){</span>
<span class="nc" id="L125">            this.drugListView.filter(this.sideBar.getSearchField().getText());</span>
        }
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (this.employeeListView != null){</span>
<span class="nc" id="L128">            this.employeeListView.filter(this.sideBar.getSearchField().getText());</span>
        }    
<span class="nc bnc" id="L130" title="All 2 branches missed.">        if (this.userListView != null){</span>
<span class="nc" id="L131">        this.userListView.filter(this.sideBar.getSearchField().getText());</span>
        }
<span class="nc" id="L133">        });</span>
<span class="nc" id="L134">        this.root.getChildren().add((SideBarGUI) this.sideBar);</span>
<span class="nc" id="L135">    }</span>

    @Override
    public void setPatientList() {
<span class="nc" id="L139">        this.patientListView = new SideBarListViewGUI(&quot;Potilas&quot;);</span>
<span class="nc" id="L140">        this.patientListView.getTitledPane().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">            if (this.patientListView.isExpanded()) {</span>
<span class="nc" id="L142">                this.patientListView.setList(this.controller.getPatients());</span>
            }
<span class="nc" id="L144">        });</span>
<span class="nc" id="L145">        this.patientListView.getListView().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L146" title="All 4 branches missed.">            if (this.patientListView.getSelection() != null &amp;&amp; this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L147">                this.tabPane.getTabs().clear();</span>
<span class="nc" id="L148">                this.setPatientDetails(this.getSelectedPatient());</span>
<span class="nc" id="L149">                this.setPatientDiagnoses(this.controller.getPatientDiagnoses());</span>
<span class="nc" id="L150">                this.setPatientPrescriptions(this.controller.getPatientPrescriptions());</span>
            }
<span class="nc bnc" id="L152" title="All 2 branches missed.">            else if (this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L153">                this.tabPane.getTabs().clear();</span>
            }
<span class="nc" id="L155">        });</span>
<span class="nc" id="L156">        this.sideBar.addView((SideBarListViewGUI)this.patientListView);</span>
<span class="nc" id="L157">    }</span>

    @Override
    public void setDrugList() {
<span class="nc" id="L161">        this.drugListView = new SideBarListViewGUI(&quot;Lääkkeet&quot;);</span>
<span class="nc" id="L162">        this.drugListView.getTitledPane().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">            if (this.drugListView.isExpanded()) {</span>
<span class="nc" id="L164">                this.drugListView.setList(this.controller.getDrugs());</span>
            }
<span class="nc" id="L166">        });</span>
<span class="nc" id="L167">        this.drugListView.getListView().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L168" title="All 4 branches missed.">            if (this.drugListView.getSelection() != null &amp;&amp; this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L169">                this.tabPane.getTabs().clear();</span>
<span class="nc" id="L170">                this.controller.getDrugDetails();</span>
                //this.loadTabPane(drugListView.getSelection());
            }
<span class="nc bnc" id="L173" title="All 2 branches missed.">            else if (this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L174">                this.tabPane.getTabs().clear();</span>
            }
<span class="nc" id="L176">        });</span>
<span class="nc" id="L177">        this.sideBar.addView((SideBarListViewGUI)this.drugListView);</span>
<span class="nc" id="L178">    }</span>

    @Override
    public void setPrescriptionList() {
<span class="nc" id="L182">        this.prescriptionListView = new SideBarListViewGUI(&quot;Omat Lääkemääräykset&quot;);</span>
<span class="nc" id="L183">        this.prescriptionListView.getTitledPane().setOnMouseClicked((event) -&gt; {</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">            if (this.prescriptionListView.isExpanded()) {</span>
<span class="nc" id="L185">                this.prescriptionListView.setList(this.controller.getDoctorPrescriptions());</span>
            }
<span class="nc" id="L187">        });</span>
<span class="nc" id="L188">        this.prescriptionListView.getListView().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">            if (this.prescriptionListView.getSelection() != null) {</span>
<span class="nc" id="L190">                this.tabPane.getTabs().clear();</span>
<span class="nc" id="L191">                this.controller.getPrescriptionDetails();</span>
            }
            else {
<span class="nc" id="L194">                this.tabPane.getTabs().clear();</span>
            }
<span class="nc" id="L196">        });</span>
<span class="nc" id="L197">        this.sideBar.addView((SideBarListViewGUI)this.prescriptionListView);</span>
<span class="nc" id="L198">    }</span>

    @Override
    public void setReceivedMessageList() {
<span class="nc" id="L202">        this.receivedMessageListView = new SideBarListViewGUI(&quot;Vastaanotetut Viestit&quot;);</span>
<span class="nc" id="L203">        this.receivedMessageListView.getTitledPane().setOnMouseClicked((event) -&gt; {</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">            if (this.receivedMessageListView.isExpanded()) {</span>
<span class="nc" id="L205">                this.receivedMessageListView.setList(this.controller.getReceivedMessages());</span>
            }
<span class="nc" id="L207">        });</span>
<span class="nc" id="L208">        this.receivedMessageListView.getListView().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L209" title="All 4 branches missed.">            if (this.receivedMessageListView.getSelection() != null &amp;&amp; this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L210">                this.tabPane.getTabs().clear();</span>
<span class="nc" id="L211">                this.setMessageDetails(this.receivedMessageListView.getSelection());</span>
            }
<span class="nc bnc" id="L213" title="All 2 branches missed.">            else if (this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L214">                this.tabPane.getTabs().clear();</span>
            }
<span class="nc" id="L216">        });</span>
<span class="nc" id="L217">        this.sideBar.addView((SideBarListViewGUI)this.receivedMessageListView);</span>
<span class="nc" id="L218">    }</span>
    
    @Override
    public void setSentMessageList() {
<span class="nc" id="L222">        this.sentMessageListView = new SideBarListViewGUI(&quot;Lähetetyt Viestit&quot;);</span>
<span class="nc" id="L223">        this.sentMessageListView.getTitledPane().setOnMouseClicked((event) -&gt; {</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">            if (this.sentMessageListView.isExpanded()) {</span>
<span class="nc" id="L225">                this.sentMessageListView.setList(this.controller.getSentMessages());</span>
            }
<span class="nc" id="L227">        });</span>
<span class="nc" id="L228">        this.sentMessageListView.getListView().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L229" title="All 4 branches missed.">            if (this.sentMessageListView.getSelection() != null &amp;&amp; this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L230">                this.tabPane.getTabs().clear();</span>
<span class="nc" id="L231">                this.setMessageDetails(this.sentMessageListView.getSelection());</span>
            }
<span class="nc bnc" id="L233" title="All 2 branches missed.">            else if (this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L234">                this.tabPane.getTabs().clear();</span>
            }
<span class="nc" id="L236">        });</span>
<span class="nc" id="L237">        this.sideBar.addView((SideBarListViewGUI)this.sentMessageListView);</span>
<span class="nc" id="L238">    }</span>

    //List all users
    @Override
    public void setUserList() {
<span class="nc" id="L243">        this.userListView = new SideBarListViewGUI(&quot;Käyttäjät&quot;);</span>
        //Create custom cells with buttons to be able to easily set users accounts in locked state
<span class="nc" id="L245">        this.userListView.getListView().setCellFactory(p -&gt; {</span>
<span class="nc" id="L246">            ListCell&lt;User&gt; cell = new ListCell&lt;User&gt;(){</span>
                @Override
                protected void updateItem(User u, boolean bln) {
<span class="nc" id="L249">                    super.updateItem(u, bln);</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">                    if (u != null) {</span>
<span class="nc" id="L251">                        setText(u.toString());</span>
<span class="nc" id="L252">                        Button button = new Button();</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">                        if (u.getUsertype() != 0) {</span>
<span class="nc" id="L254">                            button.setText(&quot;-&quot;);</span>
                        }
                        else {
<span class="nc" id="L257">                            button.setText(&quot;+&quot;);</span>
                        }
<span class="nc" id="L259">                        button.setOnAction((ActionEvent event) -&gt; {</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">                            if (u.getUsertype() != 0) {</span>
<span class="nc" id="L261">                                controller.lockUser(u);</span>
<span class="nc" id="L262">                                button.setText(&quot;+&quot;);</span>
                            }
                            else {
<span class="nc" id="L265">                                controller.setUserPriviledges(u);</span>
<span class="nc" id="L266">                                button.setText(&quot;-&quot;);</span>
                            }
<span class="nc" id="L268">                        });</span>
<span class="nc" id="L269">                        setGraphic(button);</span>
                    }
<span class="nc" id="L271">                }</span>
            };
<span class="nc" id="L273">            return cell;</span>
        });
<span class="nc" id="L275">        this.userListView.getTitledPane().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">            if (this.userListView.isExpanded()) {</span>
<span class="nc" id="L277">                this.userListView.setList(this.controller.getUsers());</span>
            }
<span class="nc" id="L279">        });</span>
<span class="nc" id="L280">        this.userListView.getListView().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">            if (this.userListView.getSelection() != null) {</span>
<span class="nc" id="L282">                this.tabPane.getTabs().clear();</span>
<span class="nc" id="L283">                this.controller.getUserDetails();</span>
            }
            else {
<span class="nc" id="L286">                this.tabPane.getTabs().clear();</span>
            }
<span class="nc" id="L288">        });</span>
<span class="nc" id="L289">        this.sideBar.addView((SideBarListViewGUI)this.userListView);</span>
<span class="nc" id="L290">    }</span>

    @Override
    public void setEmployeeList() {
<span class="nc" id="L294">        this.employeeListView = new SideBarListViewGUI(&quot;Työntekijät&quot;);</span>
<span class="nc" id="L295">        this.employeeListView.getTitledPane().setOnMouseClicked((event) -&gt; {</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">            if (this.employeeListView.isExpanded()) {</span>
<span class="nc" id="L297">                this.employeeListView.setList(this.controller.getEmployees());</span>
            }
<span class="nc" id="L299">        });</span>
<span class="nc" id="L300">        this.employeeListView.getListView().setOnMouseClicked(e -&gt; {</span>
<span class="nc bnc" id="L301" title="All 4 branches missed.">            if (this.employeeListView.getSelection() != null &amp;&amp; this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L302">                this.tabPane.getTabs().clear();</span>
<span class="nc" id="L303">                this.controller.getEmployeeDetails();</span>
            }
<span class="nc bnc" id="L305" title="All 2 branches missed.">            else if(this.status == AppStatus.IDLE) {</span>
<span class="nc" id="L306">                this.tabPane.getTabs().clear();</span>
            }
<span class="nc" id="L308">        });</span>
<span class="nc" id="L309">        this.sideBar.addView((SideBarListViewGUI)this.employeeListView);</span>
<span class="nc" id="L310">    }</span>

    @Override
    public void setDatabaseList() {
<span class="nc" id="L314">        this.databaseListView = new SideBarListViewGUI(&quot;Tietokannat&quot;);</span>
<span class="nc" id="L315">        this.databaseListView.getTitledPane().setOnMouseClicked((event) -&gt; {</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">            if (this.databaseListView.isExpanded()) {</span>
<span class="nc" id="L317">                this.databaseListView.setList(this.controller.getDatabases());</span>
            }
<span class="nc" id="L319">        });</span>
<span class="nc" id="L320">        this.sideBar.addView((SideBarListViewGUI)this.databaseListView);</span>
<span class="nc" id="L321">    }</span>
    
    @Override
    public void setPrescriptionForm(Prescription prescription) {
<span class="nc" id="L325">        this.prescriptionForm = new PrescriptionFormGUI(this.patientListView, this.drugListView, &quot;Lääkemääräys&quot;, prescription);</span>
<span class="nc" id="L326">        this.prescriptionForm.getCancelButton().setOnAction(e -&gt; {</span>
<span class="nc" id="L327">            this.tabPane.getTabs().remove(this.prescriptionForm);</span>
<span class="nc" id="L328">            this.setStatus(AppStatus.IDLE);</span>
<span class="nc" id="L329">        });</span>
<span class="nc" id="L330">        this.prescriptionForm.getSaveButton().setOnAction(e -&gt; {</span>
<span class="nc bnc" id="L331" title="All 2 branches missed.">            if (this.status == AppStatus.EDIT) {</span>
<span class="nc" id="L332">                this.prescriptionForm.markUpdate();</span>
            }
<span class="nc bnc" id="L334" title="All 2 branches missed.">            if (this.controller.savePrescription()) {</span>
<span class="nc" id="L335">                this.tabPane.getTabs().remove(this.prescriptionForm);</span>
<span class="nc" id="L336">                this.setStatus(AppStatus.IDLE);</span>
            }
            else {
                //Some kind of alert message should be thrown
            }
<span class="nc" id="L341">        });</span>
<span class="nc" id="L342">        this.prescriptionForm.getPatientField().textProperty().addListener((observable, oldValue, newValue) -&gt; {</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">            if (this.getPrescriptionForm().getPatient() != null) {</span>
<span class="nc" id="L344">                ObservableList&lt;Diagnose&gt; list = FXCollections.observableList(this.controller.getPatientDiagnoses());</span>
<span class="nc" id="L345">                this.prescriptionForm.getDiagnoseSelector().setItems(list);</span>
<span class="nc" id="L346">                this.prescriptionForm.getDiagnoseSelector().getSelectionModel().clearAndSelect(0);</span>
<span class="nc" id="L347">                this.prescriptionForm.setDiagnose(this.prescriptionForm.getDiagnoseSelector().getSelectionModel().getSelectedItem());</span>
            }
<span class="nc" id="L349">        });</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">        if (this.getSelectedPatient() != null) {</span>
<span class="nc" id="L351">            ObservableList&lt;Diagnose&gt; list = FXCollections.observableList(this.controller.getPatientDiagnoses());</span>
<span class="nc" id="L352">            this.prescriptionForm.getDiagnoseSelector().setItems(list);</span>
<span class="nc" id="L353">            this.prescriptionForm.getDiagnoseSelector().getSelectionModel().clearAndSelect(0);</span>
        }
<span class="nc" id="L355">        this.tabPane.getTabs().add((PrescriptionFormGUI)this.prescriptionForm);</span>
<span class="nc" id="L356">    }</span>
    
    @Override
    public void setMessageForm(Message message){
<span class="nc" id="L360">        this.status = AppStatus.CREATE;</span>
<span class="nc" id="L361">        this.messageForm = new MessageFormGUI(this.controller.getUsers(),message);</span>
<span class="nc" id="L362">        this.messageForm.getCancelButton().setOnAction(e -&gt; {</span>
<span class="nc" id="L363">            this.tabPane.getTabs().remove(this.messageForm);</span>
<span class="nc" id="L364">            this.setStatus(AppStatus.IDLE);</span>
<span class="nc" id="L365">        });</span>
<span class="nc" id="L366">        this.messageForm.getSendButton().setOnAction(e -&gt; {</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">            if (this.controller.saveMessage()) {</span>
<span class="nc" id="L368">                this.tabPane.getTabs().remove(this.messageForm);</span>
<span class="nc" id="L369">                this.setStatus(AppStatus.IDLE);</span>
            }
            else {
                //Some kind of alert message should be thrown
            }
<span class="nc" id="L374">        });</span>
<span class="nc" id="L375">        this.tabPane.getTabs().add((MessageFormGUI)this.messageForm);</span>
<span class="nc" id="L376">    }</span>
    
    @Override
    public void setUserForm(User_IF user) {
<span class="nc" id="L380">        this.status = AppStatus.CREATE;</span>
<span class="nc" id="L381">        this.userForm = new UserFormGUI(this.employeeListView, user);</span>
<span class="nc" id="L382">        this.userForm.getCancelButton().setOnAction(e -&gt; {</span>
<span class="nc" id="L383">            this.tabPane.getTabs().remove(this.userForm);</span>
<span class="nc" id="L384">            this.setStatus(AppStatus.IDLE);</span>
<span class="nc" id="L385">        });</span>
<span class="nc" id="L386">        this.userForm.getSaveButton().setOnAction(e -&gt; {</span>
           
<span class="nc bnc" id="L388" title="All 2 branches missed.">            if (this.controller.saveUser()) {</span>
<span class="nc" id="L389">                this.tabPane.getTabs().remove(this.userForm);</span>
<span class="nc" id="L390">                this.setStatus(AppStatus.IDLE);</span>
            }
            else {
                //Some kind of alert message should be thrown
            }
<span class="nc" id="L395">        });</span>
      
<span class="nc" id="L397">        this.tabPane.getTabs().add((UserFormGUI)this.userForm);</span>
<span class="nc" id="L398">    }</span>
    
    
    
    @Override
    public void setPrescriptionTools() {
<span class="nc" id="L404">        Button createPrescription = new Button(&quot;Uusi lääkemääräys&quot;);</span>
<span class="nc" id="L405">        createPrescription.setOnMouseClicked((event) -&gt; {</span>
<span class="nc" id="L406">            this.controller.createNewPrescription();</span>
<span class="nc" id="L407">            this.setStatus(AppStatus.CREATE);</span>
<span class="nc" id="L408">        });</span>
<span class="nc" id="L409">        this.sideBar.getVbox().getChildren().add(createPrescription);</span>
<span class="nc" id="L410">        Button updatePrescription = new Button(&quot;Muokkaa lääkemääräystä&quot;);</span>
<span class="nc" id="L411">        BooleanBinding booleanBind = Bindings.isNull(this.prescriptionListView.getListView().getSelectionModel().selectedItemProperty());</span>
<span class="nc" id="L412">        updatePrescription.disableProperty().bind(booleanBind);</span>
<span class="nc" id="L413">        updatePrescription.setOnMouseClicked((event) -&gt; {</span>
<span class="nc" id="L414">            this.setPrescriptionForm(this.prescriptionListView.getSelection());</span>
<span class="nc" id="L415">            this.setStatus(AppStatus.EDIT);</span>
<span class="nc" id="L416">        });</span>
<span class="nc" id="L417">        this.sideBar.getVbox().getChildren().add(updatePrescription);</span>
<span class="nc" id="L418">    }</span>

     @Override
    public void setUserTools() {
<span class="nc" id="L422">        Button createUser = new Button(&quot;Uusi käyttäjä&quot;);</span>
<span class="nc" id="L423">        createUser.setOnMouseClicked((event) -&gt; {</span>
<span class="nc" id="L424">            this.controller.createNewUser();</span>
<span class="nc" id="L425">            this.setStatus(AppStatus.CREATE);</span>
<span class="nc" id="L426">        });</span>
<span class="nc" id="L427">        this.sideBar.getVbox().getChildren().add(createUser);</span>

<span class="nc" id="L429">    }</span>
    @Override
    public void setPatientDetails(Patient patient) {
<span class="nc" id="L432">        ObservableList&lt;String&gt; list = FXCollections.observableArrayList();</span>
<span class="nc" id="L433">        list.add(&quot;Sosiaaliturvatunnus: &quot; + patient.getSSN());</span>
<span class="nc" id="L434">        list.add(&quot;Etunimi: &quot; + patient.getFirstName());</span>
<span class="nc" id="L435">        list.add(&quot;Sukunimi: &quot; + patient.getLastName());</span>
<span class="nc" id="L436">        list.add(&quot;Sukupuoli: &quot; + patient.getGender());</span>
<span class="nc" id="L437">        list.add(&quot;Pituus: &quot; + dsc.toString(patient.getHeight()) + &quot; cm&quot;);</span>
<span class="nc" id="L438">        list.add(&quot;Paino: &quot; + dsc.toString(patient.getWeight()) + &quot; kg&quot;);</span>
<span class="nc" id="L439">        ListTabGUI listTab = new ListTabGUI(&quot;Potilaan tiedot&quot;);</span>
<span class="nc" id="L440">        listTab.getListView().setItems(list);</span>
<span class="nc" id="L441">        this.tabPane.getTabs().add(listTab);</span>
        
<span class="nc" id="L443">    }</span>
    
    @Override
    public void setPatientDiagnoses(List&lt;Diagnose&gt; list) {
<span class="nc" id="L447">        ObservableList&lt;Diagnose&gt; diagnoses = FXCollections.observableArrayList(list);</span>
<span class="nc" id="L448">        this.patientDiagnoseTab = new ListTabGUI(&quot;Potilaan diagnoosit&quot;);</span>
<span class="nc" id="L449">        this.patientDiagnoseTab.getListView().setOnMouseClicked(e -&gt; {</span>
<span class="nc" id="L450">            this.controller.getDiagnoseDetails();</span>
<span class="nc" id="L451">        });</span>
<span class="nc" id="L452">        this.patientDiagnoseTab.getListView().setItems(diagnoses);</span>
<span class="nc" id="L453">        this.tabPane.getTabs().add((ListTabGUI)this.patientDiagnoseTab);</span>
<span class="nc" id="L454">    }</span>

    @Override
    public void setPatientPrescriptions(List&lt;Prescription&gt; list) {
<span class="nc" id="L458">        ObservableList&lt;Prescription&gt; prescriptions = FXCollections.observableArrayList(list);</span>
<span class="nc" id="L459">        this.patientPrescriptionTab = new ListTabGUI(&quot;Potilaan reseptit&quot;);</span>
<span class="nc" id="L460">        this.patientPrescriptionTab.getListView().setOnMouseClicked(e -&gt; {</span>
<span class="nc" id="L461">            this.controller.getPrescriptionDetails();</span>
<span class="nc" id="L462">        });</span>
<span class="nc" id="L463">        this.patientPrescriptionTab.getListView().setItems(prescriptions);</span>
<span class="nc" id="L464">        this.tabPane.getTabs().add((ListTabGUI)this.patientPrescriptionTab);</span>
<span class="nc" id="L465">    }</span>

    @Override
    public void setPrescriptionDetails(Prescription prescription) {
<span class="nc" id="L469">        ObservableList&lt;String&gt; list = FXCollections.observableArrayList();</span>
<span class="nc" id="L470">        list.add(&quot;Tunnus: &quot; + prescription.getId());</span>
<span class="nc" id="L471">        list.add(&quot;Luontipäivä: &quot; + prescription.getCreationDate());</span>
<span class="nc" id="L472">        list.add(&quot;Potilas: &quot; + prescription.getPatient().getLastName() + &quot;, &quot; + prescription.getPatient().getFirstName() + &quot;, &quot; + prescription.getPatient().getSSN());</span>
<span class="nc" id="L473">        list.add(&quot;Lääkäri: &quot; + prescription.getDoctor().getLastName() + &quot;, &quot; + prescription.getDoctor().getFirstName());</span>
<span class="nc" id="L474">        list.add(&quot;Diagnoosi: &quot; + prescription.getDiagnose().getId() + &quot;: &quot; + prescription.getDiagnose().getDisease());</span>
<span class="nc" id="L475">        list.add(&quot;Lääke: &quot; + prescription.getDrug().getName());</span>
<span class="nc" id="L476">        list.add(&quot;Annostus: &quot; + prescription.getDrug() + &quot;, &quot; + prescription.getDose() + &quot; &quot; + prescription.getDrug().getUnit() + &quot; &quot; + prescription.getTimesADay() + &quot; kertaa päivässä.&quot;);</span>
<span class="nc" id="L477">        list.add(&quot;Ohjeet: &quot; + prescription.getInfo());</span>
<span class="nc" id="L478">        list.add(&quot;Alkaen: &quot; + prescription.getStartDate());</span>
<span class="nc" id="L479">        list.add(&quot;Päättyen: &quot; + prescription.getEndDate());</span>
<span class="nc" id="L480">        this.tabPane.getTabs().remove(this.prescriptionTab);</span>
<span class="nc" id="L481">        this.prescriptionTab = new ListTabGUI(&quot;Reseptin tiedot&quot;);</span>
<span class="nc" id="L482">        this.prescriptionTab.getListView().setItems(list);</span>
<span class="nc" id="L483">        this.tabPane.getTabs().add((ListTabGUI)this.prescriptionTab);</span>
<span class="nc" id="L484">        this.tabPane.getSelectionModel().select((ListTabGUI)this.prescriptionTab);</span>
<span class="nc" id="L485">    }</span>
    
    @Override
    public void setDiagnoseDetails(Diagnose diagnose) {
<span class="nc" id="L489">        ObservableList&lt;String&gt; list = FXCollections.observableArrayList();</span>
<span class="nc" id="L490">        list.add(&quot;Tunnus: &quot; + diagnose.getId());</span>
<span class="nc" id="L491">        list.add(&quot;Luontipäivä: &quot; + diagnose.getCreationDate());</span>
<span class="nc" id="L492">        list.add(&quot;Potilas: &quot; + diagnose.getPatient().getLastName() + &quot;, &quot; + diagnose.getPatient().getFirstName() + &quot;, &quot; + diagnose.getPatient().getSSN());</span>
<span class="nc" id="L493">        list.add(&quot;Lääkäri: &quot; + diagnose.getDoctor().getLastName() + &quot;, &quot; + diagnose.getDoctor().getFirstName());</span>
<span class="nc" id="L494">        list.add(&quot;Sairaus: &quot; + diagnose.getDisease());</span>
<span class="nc" id="L495">        list.add(&quot;Epikriisi: &quot; + diagnose.getEpicrisis());</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">        if (diagnose.getResolutionDate() != null) {</span>
<span class="nc" id="L497">            list.add(&quot;Diagnoosin tila: hoidettu, &quot; + diagnose.getResolutionDate());</span>
        }
        else {
<span class="nc" id="L500">            list.add(&quot;Diagnoosin tila: ei hoidettu&quot; );</span>
        }
<span class="nc" id="L502">        this.tabPane.getTabs().remove(this.diagnoseTab);</span>
<span class="nc" id="L503">        this.diagnoseTab = new ListTabGUI(&quot;Diagnoosin tiedot&quot;);</span>
<span class="nc" id="L504">        this.diagnoseTab.getListView().setItems(list);</span>
<span class="nc" id="L505">        this.tabPane.getTabs().add((ListTabGUI)this.diagnoseTab);</span>
<span class="nc" id="L506">        this.tabPane.getSelectionModel().select((ListTabGUI)this.diagnoseTab);</span>
<span class="nc" id="L507">    }</span>
    
    @Override
    public void setDrugDetails(Drug drug) {
<span class="nc" id="L511">        String activeAgents = &quot;&quot;;</span>
<span class="nc" id="L512">        String allergens = &quot;&quot;;</span>
<span class="nc" id="L513">        String commonAdverseEffects = &quot;&quot;;</span>
<span class="nc" id="L514">        String rareAdverseEffects = &quot;&quot;;</span>
        
<span class="nc" id="L516">        ObservableList&lt;String&gt; list = FXCollections.observableArrayList();</span>
<span class="nc" id="L517">        list.add(&quot;Tuotenumero: &quot; + drug.getSN());</span>
<span class="nc" id="L518">        list.add(&quot;Lääke: &quot; + drug.getName());</span>
<span class="nc" id="L519">        list.add(&quot;Vaikuttavat aineet:\n\n\t&quot;+drug.getDrugActiveAgents().stream().</span>
<span class="nc" id="L520">                map((a) -&gt; a.getActiveAgent().getName()+&quot; &quot;+a.getConcentration()+&quot;mg\n\t&quot;).reduce(activeAgents, String::concat));</span>
<span class="nc" id="L521">        list.add(&quot;Lääkkeen allergeenit:\n\n\t&quot;+drug.getAllergens().stream().</span>
<span class="nc" id="L522">                map((a) -&gt; a.getName()+&quot;\n\t&quot;).reduce(allergens, String::concat));</span>
<span class="nc" id="L523">        list.add(&quot;Yleiset haittavaikutukset:\n\n\t&quot;+drug.getCommonAdverseEffects().stream().</span>
<span class="nc" id="L524">                map((a) -&gt; a.getName()+&quot;\n\t&quot;).reduce(commonAdverseEffects, String::concat));</span>
<span class="nc" id="L525">        list.add(&quot;Harvinaiset haittavaikutukset:\n\n\t&quot;+drug.getRareAdverseEffects().stream().</span>
<span class="nc" id="L526">                map((a) -&gt; a.getName()+&quot;\n\t&quot;).reduce(rareAdverseEffects, String::concat));</span>
        
<span class="nc" id="L528">        this.tabPane.getTabs().remove(this.drugTab);</span>
<span class="nc" id="L529">        this.drugTab = new ListTabGUI(&quot;Lääkkeen tiedot&quot;);</span>
<span class="nc" id="L530">        this.drugTab.getListView().setItems(list);</span>
<span class="nc" id="L531">        this.tabPane.getTabs().add((ListTabGUI)this.drugTab);</span>
<span class="nc" id="L532">        this.tabPane.getSelectionModel().select((ListTabGUI)this.drugTab);</span>
<span class="nc" id="L533">    }</span>
    
    @Override
    public void setMessageDetails(Message message) {
<span class="nc" id="L537">        ObservableList&lt;String&gt; list = FXCollections.observableArrayList();</span>
<span class="nc" id="L538">        list.add(&quot;Lähettäjä: &quot;+message.getSender().getFirstName()+&quot; &quot;+message.getSender().getLastName());</span>
<span class="nc" id="L539">        list.add(&quot;Vastaanottaja: &quot;+message.getReceiver().getFirstName()+&quot; &quot;+message.getReceiver().getLastName());</span>
<span class="nc" id="L540">        list.add(&quot;Päiväys: &quot;+message.getDate());</span>
<span class="nc" id="L541">        list.add(&quot;Viesti: &quot;+message.getMessage() );</span>
        
<span class="nc" id="L543">        this.tabPane.getTabs().remove(this.messageTab);</span>
<span class="nc" id="L544">        this.messageTab = new ListTabGUI(message.getTitle());</span>
<span class="nc" id="L545">        this.messageTab.getListView().setItems(list);</span>
<span class="nc" id="L546">        this.tabPane.getTabs().add((ListTabGUI)this.messageTab);</span>
<span class="nc" id="L547">        this.tabPane.getSelectionModel().select((ListTabGUI)this.messageTab);</span>
<span class="nc" id="L548">    }</span>
    
    @Override
    public void setUserDetails(User_IF user) {
<span class="nc" id="L552">        ObservableList&lt;String&gt; list = FXCollections.observableArrayList();</span>
<span class="nc" id="L553">        list.add(&quot;Työntekijänumero: &quot; + user.getUserID());</span>
<span class="nc" id="L554">        list.add(&quot;Käyttäjätunnus: &quot; + user.getUsername());</span>
<span class="nc" id="L555">        list.add(&quot;Sähköposti: &quot; + user.getEmail());</span>
<span class="nc bnc" id="L556" title="All 5 branches missed.">        switch (user.getUsertype()) {</span>
            case 0:
<span class="nc" id="L558">                list.add(&quot;Käyttöoikeudet: lukittu&quot;);</span>
<span class="nc" id="L559">                break;</span>
            case 1:
<span class="nc" id="L561">                list.add(&quot;Käyttöoikeudet: hoitaja&quot;);</span>
<span class="nc" id="L562">                break;</span>
            case 2:
<span class="nc" id="L564">                list.add(&quot;Käyttöoikeudet: lääkäri&quot;);</span>
<span class="nc" id="L565">                break;</span>
            case 3:
<span class="nc" id="L567">                list.add(&quot;Käyttöoikeudet: ylläpitäjä&quot;);</span>
<span class="nc" id="L568">                break;</span>
            default:
                break;
        }
<span class="nc" id="L572">        this.tabPane.getTabs().clear();</span>
<span class="nc" id="L573">        ListTabGUI_IF listTab = new ListTabGUI(&quot;Käyttäjän tiedot&quot;);</span>
<span class="nc" id="L574">        listTab.getListView().setItems(list);</span>
<span class="nc" id="L575">        this.tabPane.getTabs().add((ListTabGUI)listTab);</span>
<span class="nc" id="L576">    }</span>
    
    @Override
    public void setEmployeeDetails(Employee employee) {
<span class="nc" id="L580">        ObservableList&lt;String&gt; list = FXCollections.observableArrayList();</span>
<span class="nc" id="L581">        list.add(&quot;Työntekijänumero: &quot; + employee.getUserID());</span>
<span class="nc" id="L582">        list.add(&quot;Etunimi: &quot; + employee.getFirstName());</span>
<span class="nc" id="L583">        list.add(&quot;Sukunimi: &quot; + employee.getLastName());</span>
<span class="nc" id="L584">        list.add(&quot;Titteli: &quot; + employee.getTitle());</span>
<span class="nc" id="L585">        list.add(&quot;Sähköposti: &quot; + employee.getEmail());</span>
<span class="nc" id="L586">        this.tabPane.getTabs().clear();</span>
<span class="nc" id="L587">        ListTabGUI_IF listTab = new ListTabGUI(&quot;Työntekijän tiedot&quot;);</span>
<span class="nc" id="L588">        listTab.getListView().setItems(list);</span>
<span class="nc" id="L589">        this.tabPane.getTabs().add((ListTabGUI)listTab);</span>
<span class="nc" id="L590">    }</span>
      
    @Override
    public Patient getSelectedPatient() {
<span class="nc" id="L594">        return this.patientListView.getSelection();</span>
    }

    @Override
    public Prescription getSelectedPrescription() {
        //Fix this! If patient tab was selected and then trying to view doctor's
        //prescription, this method returns null.
<span class="nc bnc" id="L601" title="All 2 branches missed.">        if(this.patientPrescriptionTab != null){</span>
<span class="nc" id="L602">            return this.patientPrescriptionTab.getSelection();</span>
        }else{
<span class="nc" id="L604">            return this.prescriptionListView.getSelection();</span>
        }
    }
    
    @Override
    public Diagnose getSelectedDiagnose() {
<span class="nc" id="L610">        return this.patientDiagnoseTab.getSelection();</span>
    }
    
    @Override
    public Drug getSelectedDrug() {
<span class="nc" id="L615">        return this.drugListView.getSelection();</span>
    }
    
    @Override
    public Message getSelectedMessage() {
<span class="nc" id="L620">        return this.receivedMessageListView.getSelection();</span>
    }
    
    @Override
    public User_IF getSelectedUser() {
<span class="nc" id="L625">        return this.userListView.getSelection();</span>
    }
    
    @Override
    public Employee getSelectedEmployee() {
<span class="nc" id="L630">        return this.employeeListView.getSelection();</span>
    }

    @Override
    public Prescription getPrescriptionForm() {
<span class="nc" id="L635">        return this.prescriptionForm.getPrescription();</span>
    }

    @Override
    public Message getMessageForm() {
<span class="nc" id="L640">        return this.messageForm.getMessage();</span>
    }

    
    
    @Override
    public User_IF getUserForm() {
<span class="nc" id="L647">        return this.userForm.getUser();</span>
    
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>